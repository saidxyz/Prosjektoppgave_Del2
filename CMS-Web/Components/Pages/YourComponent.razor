@using CMS_Web.Services
@inject HttpClient HttpClient
@inject TokenService TokenService
@code {
    private string token;

    protected override async Task OnInitializedAsync()
    {
        // Get the token from localStorage
        token = await TokenService.GetTokenAsync();

        // Set Authorization header if token exists
        if (!string.IsNullOrEmpty(token))
        {
            HttpClient.DefaultRequestHeaders.Authorization = 
                new System.Net.Http.Headers.AuthenticationHeaderValue("Bearer", token);
        }
    }

    private async Task GetData()
    {
        var response = await HttpClient.GetAsync("api/protected-data");

        if (response.IsSuccessStatusCode)
        {
            var data = await response.Content.ReadAsStringAsync();
            // Do something with the data
        }
        else
        {
            // Handle error
        }
    }
}